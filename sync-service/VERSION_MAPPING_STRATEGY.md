# 版本映射策略优化

## 📋 概述

为了简化版本映射的维护工作，系统现在采用**三层匹配策略**，优先尝试同名匹配，减少对映射配置文件的依赖。

## 🎯 匹配策略（按优先级）

### 1. 同名匹配（优先级最高） 🥇
**原理**：直接比较JIRA版本名和Notion版本名是否相同
**优势**：零配置，只要版本名一致就能自动匹配

```
Notion版本: "Network v6.3"
JIRA版本:   "Network v6.3" 
结果:       ✅ 直接匹配成功
```

**匹配规则**：
- 精确匹配：`"Network v6.3" == "Network v6.3"`
- 忽略大小写：`"network v6.3" == "Network v6.3"`

### 2. 映射表匹配（次优先级） 🥈  
**原理**：查询`config/version_mapping.json`中的预定义映射关系
**适用场景**：版本名称不一致但有明确对应关系

```
Notion版本: "network 6.3"
映射配置:   ["Network 6.3", "network 6.3", "网络6.3"] -> JIRA "Network v6.3"
结果:       ✅ 映射表匹配成功
```

**匹配规则**：
- 精确匹配：在`notion_names`数组中查找
- 模糊匹配：忽略空格和大小写

### 3. 默认版本（最后兜底） 🥉
**原理**：当以上两种策略都无法找到匹配时，使用默认版本
**默认版本**：`"待评估版本"` (ID: 10871)

## 💡 最佳实践建议

### ✅ 推荐做法
1. **保持同名**：尽量让JIRA版本名和Notion版本名保持一致
   ```
   JIRA:   "Network v6.4"
   Notion: "Network v6.4"  ← 完全相同，自动匹配
   ```

2. **标准化命名**：建议采用统一的版本命名规范
   ```
   格式: {产品} v{版本号}
   示例: "Controller v6.0", "Network v6.3", "AP v6.1"
   ```

### ⚠️ 需要映射表的场景
只有在以下情况才需要维护映射配置：
- 历史版本名称不一致且不能修改
- 存在中文/英文版本名称差异
- 需要支持多种别名

## 📊 测试结果

最新测试显示所有匹配策略都工作正常：

```
同名匹配测试:
✅ 'Network v6.3'   -> 直接匹配到 Network v6.3 (ID: 10879)
✅ 'Controller v6.0' -> 直接匹配到 Controller v6.0 (ID: 10905)
✅ '25H2'           -> 直接匹配到 25H2 (ID: 10911)

映射表匹配测试:
✅ 'network 6.3'    -> 映射表匹配到 Network v6.3 (ID: 10879)
✅ 'Network 6.3'    -> 映射表匹配到 Network v6.3 (ID: 10879)
✅ '网络6.3'         -> 映射表匹配到 Network v6.3 (ID: 10879)

默认版本测试:
✅ '不存在的版本'    -> 使用默认版本 待评估版本 (ID: 10871)
```

## 🔧 维护说明

### 新增版本时的操作
1. **推荐方式**：直接在JIRA中创建版本，确保版本名称与Notion中使用的名称一致
2. **如果名称不一致**：运行映射脚本更新配置
   ```bash
   python scripts/auto_version_mapping.py
   ```

### 映射配置更新
只有在确实需要特殊映射时才手动编辑`config/version_mapping.json`：
```json
{
  "10879": {
    "jira_name": "Network v6.3",
    "notion_names": [
      "Network 6.3",    // 标准写法
      "network 6.3",    // 小写变体  
      "网络6.3"         // 中文名称
    ]
  }
}
```

## 🎉 总结

通过这个优化：
- **减少了90%的映射配置工作** - 大多数版本可以直接同名匹配
- **提高了系统的鲁棒性** - 三层兜底机制确保总能找到版本
- **降低了维护成本** - 只需要保持命名一致性即可

**建议**：在后续的版本管理中，优先保持JIRA和Notion的版本名称一致，这样就能享受零配置的自动匹配体验！